# ElephantQ Supervisor Configuration
# Place this file in /etc/supervisor/conf.d/elephantq.conf

[group:elephantq]
programs=elephantq_worker,elephantq_dashboard

[program:elephantq_worker]
command=/opt/elephantq/venv/bin/elephantq start --concurrency=4
directory=/opt/elephantq
user=elephantq
autostart=true
autorestart=true
startretries=3
redirect_stderr=true
stdout_logfile=/var/log/elephantq/worker.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=5
environment=ELEPHANTQ_DATABASE_URL="postgresql://elephantq:password@localhost/elephantq_prod",ELEPHANTQ_LOG_LEVEL="INFO",ELEPHANTQ_DASHBOARD_ENABLED="true"

[program:elephantq_dashboard]
command=/opt/elephantq/venv/bin/elephantq dashboard --host=0.0.0.0 --port=8000
directory=/opt/elephantq
user=elephantq
autostart=true
autorestart=true
startretries=3
redirect_stderr=true
stdout_logfile=/var/log/elephantq/dashboard.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=5
environment=ELEPHANTQ_DATABASE_URL="postgresql://elephantq:password@localhost/elephantq_prod",ELEPHANTQ_LOG_LEVEL="INFO"

# Optional: Additional worker for high-priority jobs only
[program:elephantq_priority_worker]
command=/opt/elephantq/venv/bin/elephantq start --concurrency=2 --queues=urgent
directory=/opt/elephantq
user=elephantq
autostart=true
autorestart=true
startretries=3
redirect_stderr=true
stdout_logfile=/var/log/elephantq/priority_worker.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=5
environment=ELEPHANTQ_DATABASE_URL="postgresql://elephantq:password@localhost/elephantq_prod",ELEPHANTQ_LOG_LEVEL="INFO"

# Health check program
[program:elephantq_healthcheck]
command=/opt/elephantq/scripts/health_check.sh
directory=/opt/elephantq
user=elephantq
autostart=false
autorestart=false
